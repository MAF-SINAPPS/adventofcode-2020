using System;
using System.Diagnostics;
using System.Linq;

namespace AdventOfCode2020.Puzzles
{
    public static class Day3Puzzle
    {
        private const string _input = @"
....#..#.......#........#....#.
..##.#.#.#...................#.
....#.#.##..#....#......#......
.........#.#......##.....#.....
..........#.###.##...##........
#....#.#.......##.....#..#.....
#...........#.#...#..#..##.##..
......##.............#.....#...
..##..........###..#.#..##.....
...........#........#......##..
..##...........##..............
..#......###.#.....#.#.#.......
..#..#..#..........#.#....#....
.#.....##......................
...#...##..#...#.........#..##.
.#......#..#..#...#......#.##..
..##.##.......#..#.....#..#...#
..............#..#..#...#......
...#...#....##.....#...#...#...
......................#...#....
.......#......#...#..##...#.#..
##......#..#.....#....#.....#..
....#.#.##.#.#....#............
#.....##.............#.........
..........#...........#.#.....#
...#...##....#.#........#..#...
................#..#.##.##....#
......#...#...##...##....#.....
##....#..#..#...#..#...........
#..................#...#.#..#..
....##....##.#....#..#......#..
.....#...........#.........##..
..#..............#.........#..#
......##....................#..
..#.....###...####...#...#.##..
#..#.#......#.....#.......#.#..
##.#.........######........#...
..#....###...#.#..............#
.....#..............#.........#
....#......#..#.........#...#..
.....###.....#.###.......###...
#.#..#.....#....##...#........#
..##....#..#.........#...#.#...
..#..##.............#....#.#.#.
..##.#..#.#.#.........##.......
#.#..#.........#..............#
#..#.........###.......#.#..#.#
.............#...#....#......#.
..........#.#...##.###.....#.#.
..#.....#......................
.......#......###.#.......#....
....#....#.........#...###.#.#.
.#.............#............#..
....#..#.............#.#....#..
....#.....#...#...##.#.........
..#...#...#..................#.
........#....#.....#...........
.....##.......#...#.#..#..#....
...#............#..#.#.........
......................#........
....#......#.....#.#....#......
.....#..#.........#.........##.
...............#.....#....##...
...#.#.#...#..#...........#....
.#....###......##...#.#.#.#....
.....#...#....####....##.......
..#......#..#.....##.#...#.....
...#.##..#....#..##.....#......
..#......#...#...##.....#...#..
......#.....#........#.........
..#.#....#..............##....#
..#...#......##............#...
.##.#.......#.......#......#..#
...##.##...#.....#.......#..#..
......##..#....#.......#.......
.....#..#..#.#.....#.....#...##
##.#...#.#.#.....#...#.#.#.##.#
...................###...#..#..
.#.....##.#......#........#....
.##...##.#..........#...#....#.
......#..............#.#......#
...#.......#..#...........#....
.###...#............##..#...##.
##..#.#.........#............#.
#...#.#......#.##...........#.#
.#.#...#........#......##......
....#...#...#.....#...#....#...
...##...........##.........#...
.........#...#..###............
..#........#...............#...
.............#....#.#..........
........#......#.#.......#....#
.................#....##.#.##..
..#...##........#..............
#..#........#...#....#.........
......#.#.....#.....#..###.#..#
....#............#...#.#.#.....
............#..........#...#...
..........#....##.#.........#..
..............#...#...#..#.....
#......#....#..##....#......##.
...#....#.................#....
.#.##.............#...#....##..
....#..#.........#..#....#....#
..#.....##..#......#.#..#......
..#..#.....#........#...#..#..#
.........##.#.##.#.......#....#
..#.......##.##...#.....#.....#
.............##...#...........#
..#......#..#....#...#..#.##...
....#........#......#.........#
.......#........#..#.#.#..##..#
..#......#...........##...#....
.....#..#.#...#..............##
.#..#......#......#........#..#
...##...............#....#.....
.......#...#.......##..#.......
.....#....#...#...#..#.....#.#.
...#.........#.....#...........
...#.....###....#....#...#...#.
#..#.....#.........#.........#.
.................#.#.....#....#
...........#..........#..#.....
........#.#....#...#..#.....###
#............................#.
..##..#..#...##.........#......
......##....#.#...#.........#..
......#..##.#......#..#.....#..
...#.......##....#.#....#......
.....#........#...#............
#.......#...#.........#......#.
......#......#....#..#.........
..#.#........#..#......#....#..
.#..#.#..........##....###.#..#
...#....#.##..#...#....#.......
..#.....#......#.###.......#...
..............................#
.....#..#...#...........#......
.##...#....##....#.#.#.#....#.#
.#...#....#...#........#.......
....#............#...##..#.....
....##..#....#....#.....#....##
.............#..##.#.#.#.......
#.......#.#.#.......#..#..#....
#..#...........#.......###..#..
.#..##.#.....#........#........
..#.#.......#............#..#..
...........#..#............##.#
.....#.......#.....#..#.##.#..#
......#......##.....##.........
..##.#..#.#..#..#..............
.....#.............##...#.#.##.
.#......##.#..........#........
..#..#.........#.....#.#.#.....
..#.....#.......#.....#..#.....
#.#.#........#.#...#....#..#...
.#.#.......#............#....#.
......#..................#....#
.#...#...#.....#.#..........#..
.#..##....####...........#.#...
..##.....#...#.#....#....#.....
#.....................#....#.#.
###..###.#.#...........#.....##
......#......#..........#......
...#......#.##.....#......###.#
.............#..#.#...........#
..#.............#.#..#.....#...
...#...............#....##...##
........#.................#....
#..###.....#.......##.#......##
....#.#..............#.........
#..........#.....#..##...#.....
................#...#..#....#..
..#...#....##..........#.#.....
......#........##......#..#...#
...#....#..#.....#.......#...#.
.#.....#..#...#..###....#......
....#.........#....#.#.#.....#.
#.#....#...#....#.....#..##....
.......#..#..#..........#...#..
..#.#..#.....##.#.#............
..#....#.....#..##..#..#.#..#..
..#.##.#...........#...#..#....
.........#........#...#........
..#.#.#.......##.........#.##..
#.#..........#.#...#..#......##
.#..#....................#.#...
.##......#................#...#
..##.#######......#....#.......
....#...##.#....#.#............
.##....#...##.......#...#..#...
...........#...#...#...#..#....
#...#.....#.......#....#.....#.
.............#.................
........#.#.......#...#.#.#....
..............#............#.#.
......#......##..#.......#....#
##...#..................#......
.....#......###.....#.......#.#
.....#.#............#.#........
..#.#..#............#....#.#...
##.#.###.#.#.#..#......#.......
...##........#..#.....#.#.#..#.
##......#.##.....####..#.......
............#...#..#...#..#....
...#..#................##.#..#.
.#....#.#...........##.#.#...#.
####..#...........#.......###..
.......#.................#.....
.......#....#.......##....#....
..#.........#...#....#.........
..........#..#...#.#...##..#...
....##..........#.........##...
#.........##..#.#..#.......#...
.#...........#....#...#...#.#..
....#..#.....#...##....#.#....#
.#....#.....#......#..##.##.#.#
#......#..#.......##...........
...#..#...#.#.................#
......#.......##....##.#......#
....#....#.#.#.....#....#....#.
..#..........#.##...##..#......
...#..#........#....#.#..#....#
##.......#........#..........#.
.#........#.......#...#..##...#
..#..#..##..#...........#...###
..#......#..........#..##......
.#.....#..#.#...#...#.........#
#.#......##....................
#...#.....##...........#.......
........#...#....#.......##....
...#.##...#....#....#..#..#..#.
...#..#......##....#..#..##....
#...#..........#.#.............
##..#........##.....#.........#
.....#......#.#...###..#.......
#..##.#..#.###...........##..#.
.....#....#..........#.......#.
##.........##.#................
....#.........#............##..
.......#........#......#..#..##
.#...#...##..#....#..#.........
.............#...#.#........#..
......#..#...#..#.###..#.......
........##.#..#.#..#..#........
#.##..#..#..........#...##..###
.##...#............#.#...##..#.
................#....##.#...#..
#.................#..........#.
...#..#..#.....................
..#...##.#.#...................
.....#...#.......#............#
..#..#.........#..##.#..#.#...#
.....#.#.....#.#.......#.....#.
..................#..#....#.#..
..#.....###.##.......##....#.#.
..#......##.......#....##.#....
....#...................#..##.#
.......#....#.##.#.......#....#
..#...#......#..#...###....#.#.
..#..#.#....#...........#.....#
.....#..#..#.......#........#..
......#.##.#......#...........#
#...#....#.#..##.##..#..##.....
#...##....#.#...##........#....
..##............#.#.#..........
....#.....#.#..#.......#..#....
#..#.#.....#..#..##...#..##....
...##........#...........#...#.
.####......#..##.........#.#...
.......#.......................
.................#....#..#.....
.........##......###...........
.##......#.#.#....#.#...#..###.
....#......##.###.#.#..#.......
..........#.......##......##..#
...........#.......#..##.......
.....###..#..............##....
........##..#.#.#......#....#..
#....#.........................
...........#...............##..
......#.................#......
.....#...#..##...##...#...#....
..........#.#...##.####......#.
..#.#.....##....#...........#..
..........#....#..#....##...#..
.#.......#..##...#...#.....#...
...##....#.#......##...##....#.
#.......#.......#.##.#...#.#...
#...#..................#......#
..#.......#...............#..##
#.....#..................#....#
.##.....#.....#......####.....#
..#........#...#.#........#...#
..##.....#....#...#...........#
..#..#.....##..#.##...#........
..........###..#....##.....#...
...#...#....#.##.#...#.#.......
..##......#.......#.......##...
............#............#.....
.##....#.........#.............
....#....#....#........##...#.#
.......##......................
..........#.#.................#
......##.#...#.........#.....#.
..#...#......#..#.............#
..........###.#..#.#...#..#..#.
#..#.#..#....##...#...#.#...#..
.#........##...#......#.##.....
...###.#...##..............##..
#.#.#...#...#..#....#.#..#.....
.#.#.##..#....#......#.#.......
...#..#.#....##...........#..#.
.....##..##......#.#...........
......#.....#....####....#.....
.#.#.#...#..#..#...........#...
.....#......................#..
.........#.........#.###.##....
.....#......##..........#......
..#...........##...........#...
..............#.........#.....#
..#....#..#...#...##.#.........
.#.#.#....#..........#.........
";

        public static void Part1_1()
        {
            var inputAsRows = _input.Split(Environment.NewLine, StringSplitOptions.RemoveEmptyEntries);
            var column = 0;
            var treesCount = 0;
            foreach (var row in inputAsRows)
            {
                while (column > row.Count() - 1)
                    column -= row.Count();
                treesCount += (row[column] == '#') ? 1 : 0;
                column += 3;
            }
            Debug.WriteLine("Day 3 part 1 v1: " + treesCount);
        }

        public static void Part1_2()
        {
            var inputAsRows = _input.Split(Environment.NewLine, StringSplitOptions.RemoveEmptyEntries);
            var column = 0;
            var treesCount = 0;
            foreach (var row in inputAsRows)
            {
                treesCount += (row[column % 3] == '#') ? 1 : 0;
                column += 3;
            }
            Console.WriteLine("Day 3 part 1 v2: " + treesCount);
        }

        public static void Part2()
        {
            var inputAsRows = _input.Split(Environment.NewLine, StringSplitOptions.RemoveEmptyEntries);
            var result =
                new[]
                {
                    (right: 1, down: 1),
                    (right: 3, down: 1),
                    (right: 5, down: 1),
                    (right: 7, down: 1),
                    (right: 1, down: 2),
                }.Select(_ =>
                {
                    long treesCount = 0;
                    var column = 0;

                    for (int r = 0; r < inputAsRows.Count(); r += _.down)
                    {
                        var row = inputAsRows[r];
                        while (column > row.Count() - 1)
                            column -= row.Count();
                        treesCount += (row[column] == '#') ? 1 : 0;
                        column += _.right;
                    }
                    return treesCount;
                });

            Console.WriteLine("Day 3 part 2: " + result.Aggregate((_, __) => _ * __));
        }
    }
}
